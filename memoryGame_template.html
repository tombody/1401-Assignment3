<html>
	<head>
		<title>Memory Game</title>
	</head>
	<body>

		<div id='titleArea' style="text-align: center"></div>
		<hr>
		<div id='gameArea'></div>
		<div id='buttonArea' style="text-align: center"></div>

		<script>
		//-----------------------------------------------------------------------------
		//Constants
		SIZE = 52;
		PAIR = 2;
		SUITS = new Array('Spade', 'Heart', 'Diamond', 'Club');
		RANKS = new Array('Ace','2','3','4','5','6','7','8','9','10','Jack','Queen','King');
		
		//-----------------------------------------------------------------------------
		//Variables
		var titleArea = document.getElementById("titleArea");
		var gameArea = document.getElementById("gameArea");
		var buttonArea = document.getElementById("buttonArea");

		//Stores the setTimeout object
		var gameTimer;

		//Preloads the backCard image
		var preloadBackCard = new Image();
		preloadBackCard.src = 'back.gif'

		//Preloads the card images
		var preloadImages = [];
		for(i=0; i<SIZE; i++){
				preloadImages[i] = new Image();
				preloadImages[i].src = i+'.png';		
			}

		//Stores the IDs for all the cards
		var cardSet = [];		
		
		//Stores the IDs of the two cards the player is choosing currently
		var guessCards = [];

		//Stores the IDs of cards player has guessed correctly
		var pairedCards = [];

		//-----------------------------------------------------------------------------
		//Functions

		//Sets up the cards in a HTML table and sets up a unique ID for each image.
		function setGame(){
			//Creates HTML string to insert into gameArea.innerHTML
			var gameAreaHTML;
			gameAreaHTML="<table border='1'>";
			for (i=0; i<4; i++){
				gameAreaHTML+="<tr>";
				for (j=0; j<13; j++){
					var id=j+i*13;
					gameAreaHTML+=('<td><image id="'+id+'" src='+preloadBackCard.src+' width=140 onclick="selectCard(id)"></td>');
				}
				gameAreaHTML+="</tr>";
			}
			gameAreaHTML+="</table>";
			gameArea.innerHTML=gameAreaHTML;

			//Stores the unique IDs for each card
			for(i=0; i<SIZE; i++){
				cardSet[i]=document.getElementById(i);
			}
			
			//Sets up the buttons in buttonArea
			buttonArea.innerHTML='<p> <input id="stopGame" type="button" value="Stop Game" onclick="stopGame();"/> <input id="showCards" type="button" value="Show Cards" onclick="showCard(0);"/> <input id="flipCards" type="button" value="Flip Cards" onclick="flipCard(0);"/> </p>'
		}

		//Turns all cards face up with a small pause between each flip
		function showCard(cardId){
			if(cardId<SIZE){
				var imageRef=document.getElementById(cardId);
				imageRef.src=preloadImages[cardId].src;
				cardId++;
				//Animates the flip card every 10 milliseconds
				t = setTimeout(function(){
					showCard(cardId)
				}, 10);
			}
		}

		//Flips cards back over if they haven't been paired already
		function flipCard(cardId){
			if(cardId<SIZE){
				var imageRef=document.getElementById(cardId);

				//Checks to see if card has been paired already
				//If it isn't a paired card, flip the card
				if(!isPairedCard(cardId)){
					imageRef.src=preloadBackCard.src;
				}
				cardId++;
				//Animates the flip card every 10 milliseconds
				t = setTimeout(function(){
					flipCard(cardId)
				}, 10);
			}
		}

		//Checks if a card is in the collection of found paired cards
		//If found, return true, if not, return false
		function isPairedCard(cardId){
			//cardId has to be converted to string since pairedCard 
			//elements are strings and not numbers		
			if(pairedCards.indexOf(String(cardId))>-1){
					return true
				} else{
					return false
				}
		}

		function sortCards(cardsToSort){
			//Sorting the paired cards using the bubblesort algorithm
			//--------------NOT SORTING CARDS PROPERLY---------------------
			var i;
			var j;
			var temp;

			for(i=0; i<cardsToSort.length-1; i++){
				for(j=0; j<cardsToSort.length-1; j++){
					if(cardsToSort[j]>cardsToSort[j+1]){
						temp=cardsToSort[j];
						cardsToSort[j]=cardsToSort[j+1];
						cardsToSort[j+1]=temp;
					}
				}
			}


		}

		//Starts a new game. Called on startup
		function playGame(){
			//In this part
			//A loop that accesses each element in preloadImages and cardSet


			//Resets the guess and pair arrays
			guessCards=[];
			pairedCards=[];

			//Reshuffles cards
			//shuffleCards(cardSet);

			//Flips all the cards back over
			//flipCard(0);

			//Resets the timer
			resetTimer(60);
		}

		//Reprints the title with the countdown timer
		function resetTimer(sec){
			titleArea.innerHTML="<h1>Memory Game (Time Left: "+sec+" seconds)</h1>";
			gameTimer=setTimeout(function(){
				if(sec>=0){
					resetTimer(sec)
				}else{
					stopGame();
				}
			},1000);
			sec--;
		}

		//Stops the game when the button is clicked or the timer runs out
		function stopGame(){
			var displayMsg;

			//Stops the timer
			clearTimeout(gameTimer);

			//Not sure about this yet
			sortedCards=pairedCards;
			
			//Sorts the cards 
			alert(sortedCards);
			sortCards(sortedCards);
			alert(sortedCards);

			//Displays the results 
			//-------------SUITS NOT WORKING------------------
			displayMsg="You have found "+pairedCards.length/2+" pairs:\n\n"
			for(i=0; i<sortedCards.length; i=i+2){
				displayMsg+=SUITS[sortedCards[i]%4]+"-"+RANKS[sortedCards[i]%13];
				displayMsg+=" -- ";
				displayMsg+=SUITS[sortedCards[i+1]%4]+"-"+RANKS[sortedCards[i+1]%13]+"\n";
			}
			alert(displayMsg);

			//Prepares a new game for the next session
			//playGame();
		}

		//---------------------TO DO---------------------------------
		function shuffleCards(array){

		}

		//Flips cards over and determines pairs on user click
		function selectCard(cardId){
			//Stores the image reference
			var imageRef;
			
			//Checks if card is not in pairedCards
			if(pairedCards.indexOf(cardId)==-1){
				imageRef=document.getElementById(cardId);
				//Changes the source image
				imageRef.src=preloadImages[cardId].src;
				
				//Pushes the array to guessCards if it's the first guess
				//or it's the second and  it doesn't match the first card
				if(guessCards.length<2 && guessCards[0]!=cardId){
					guessCards.push(cardId);
				} 

				if(guessCards.length==2){
					//Checks the cards value
					var cardRank1=guessCards[0]%13;
					var cardRank2=guessCards[1]%13;

					//If the cards are the same then add to pairedCards
					//else flip them back over
					if(cardRank1==cardRank2){
						pairedCards.push(guessCards[0]);
						pairedCards.push(guessCards[1]);
					} else{
						imageRef1=document.getElementById(guessCards[0]);
						imageRef2=document.getElementById(guessCards[1]);

						//Animates the cardflip
						setTimeout(function(){
							imageRef1.src=preloadBackCard.src;
							imageRef2.src=preloadBackCard.src;
						},300);
					}

					//Resets guessCards
					guessCards = [];
				}
			}
		}		
		
		//-----------------------------------------------------------------------------
		//Statements that run when page loads

		setGame();
		playGame();

		</script>
	</body>
</html>